<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Confirmar Pago y Monto</title>
    <link rel="stylesheet" th:href="@{/css/pago.css}">
    </head>
<body>

    <h1>Cálculo y Confirmación de Monto</h1>

    <div th:if="${error}" class="message-error">
        <p><strong>Error al calcular el monto:</strong> <span th:text="${error}"></span></p>
        <p><a th:href="@{/registro-pago/pagos-pendientes(idAlquiler=${idAlquiler})}">Volver a seleccionar pagos</a></p>
    </div>

    <div th:if="${pago != null}" class="container-datos">
        
        <h2>Detalles del Pago</h2>
        
        <div th:if="${mensajeRetraso}" style="color: orange; font-weight: bold;">
            <p><span th:text="${mensajeRetraso}"></span> - Se ha aplicado un recargo por mora.</p>
        </div>
        
        <ul>
            <li><strong>ID Pago:</strong> <span th:text="${pago.idPago}"></span></li>
            <li><strong>Monto Final a Pagar:</strong> <strong th:text="${monto}"></strong></li>
        </ul>
        
        <hr>

        <form th:action="@{/registro-pago/registrar}" method="post">
            
            <input type="hidden" name="idPago" th:value="${pago.idPago}">
            <input type="hidden" name="fechaPago" th:value="${fechaPago}"> 
            <input type="hidden" name="montoPagado" th:value="${monto}"> 

            <fieldset>
                <legend>Seleccionar Forma de Pago</legend>
                <select name="idFormaPago" required>
                    <option value="">-- Seleccione una forma de pago --</option>
                    <option th:each="forma : ${formasPago}" 
                            th:value="${forma.idFormaPago}" 
                            th:text="${forma.nombre}">Efectivo</option>
                </select>
            </fieldset>

            <fieldset>
                <legend>Opciones Adicionales</legend>
                <input type="checkbox" id="solicitarComprobante" name="solicitarComprobante" value="true">
                <label for="solicitarComprobante">Solicitar Comprobante de Pago</label>
            </fieldset>
            
            <button type="submit" class="btn-primary btn-success">CONFIRMAR Y REGISTRAR PAGO</button>
        </form>
        
    </div>

</body>
</html>